---
title: "Rcpp的初次尝试"
author: "郁农欣"
date: 2017-09-29T21:00:00-02:00
categories: ["R"]
tags: ["R Markdown", "Rcpp"]

---



<p>Rcpp包作为连接R和C++的利器，是广大R语言使用者使用最广泛的拓展包。R语言给我们提供了丰富多样的统计计算函数和最新的统计模型包，但是受制于自身语言运算速度，R语言在计算循环时耗时巨大，因此需要引入更快的底层语言对其进行加速，C++作为一种计算速度非常快的中级语言，非常好的契合了这个需求，而Rcpp包则提供了两种语言互相沟通的完美结合方式。</p>
<p>作为曾经学习过C++的人，对于单个的.cpp文件源代码更熟悉，而inline形式的C++代码插入并不利于我编写函数，因此我们首先从调用.cpp文件中的函数开始学习Rcpp包。</p>
<p>我们首先用C++写一个斐波那契函数：</p>
<pre class="rcpp"><code>#include &lt;Rcpp.h&gt;
using namespace Rcpp;
// [[Rcpp::export]]
int fib_cpp_1(int n)
{
  if(n==1||n==2) return 1;
  return fib_cpp_1(n-1)+fib_cpp_1(n-2);
}</code></pre>
<p>此时我们将其保存为<code>fib_cpp_1.cpp</code>文件，同时我们希望在其中引入R代码进行比较的话，可以使用</p>
<pre><code>/*** R
library(microbenchmark)
fib &lt;- function(n){
  if(n==1|n==2) return(1)
  return(fib(n-1)+fib(n-2))
}
microbenchmark(fib_cpp_1(15),fib(15))
*/</code></pre>
<p>将这部分代码插入.cpp文件，并在R语言中使用<code>Rcpp::sourceCpp()</code>函数可以得到下面的结果：</p>
<pre class="r"><code>Rcpp::sourceCpp(&#39;fib_cpp_1.cpp&#39;)</code></pre>
<pre><code>## 
## &gt; library(microbenchmark)
## 
## &gt; fib &lt;- function(n) {
## +     if (n == 1 | n == 2) 
## +         return(1)
## +     return(fib(n - 1) + fib(n - 2))
## + }
## 
## &gt; microbenchmark(fib_cpp_1(15), fib(15))
## Unit: microseconds
##           expr     min      lq       mean   median       uq      max neval
##  fib_cpp_1(15)   2.053   2.875   19.05818   4.9270   12.522 1096.164   100
##        fib(15) 738.577 794.411 1079.97201 933.1765 1215.428 5430.320   100</code></pre>
